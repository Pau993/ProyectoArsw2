import{P as C,W as I}from"./BKcuVyL8.js";import{_,r as d,o as A,H as z,t as b,v as P,x as S,y as R,z as N}from"./Bfkd4uJK.js";class x{constructor(){this.image=null,this.collision=!1}async loadImage(e){return new Promise(s=>{this.image=new Image,this.image.onload=()=>s(),this.image.src=e})}}class j{constructor(e,s,i){this.tiles=[],this.tileMap=[],this.maxScreenCol=e,this.maxScreenRow=s,this.tileSize=i,this.tiles=new Array(20).fill(null).map(()=>new x),this.tileMap=Array(e).fill(0).map(()=>Array(s).fill(0))}async loadTiles(){const s=[{path:"/map/SeRenta.png",collision:!0},{path:"/map/grass.png",collision:!0},{path:"/map/tree.png",collision:!0},{path:"/map/Peluqueria.png",collision:!0},{path:"/map/Bar.png",collision:!0},{path:"/map/roadNEWS.png",collision:!1},{path:"/map/roadNS.png",collision:!1},{path:"/map/Farmacia.png",collision:!0},{path:"/map/Fotostudio.png",collision:!0},{path:"/map/Panaderia.png",collision:!0},{path:"/map/Fruteria.png",collision:!0},{path:"/map/Musica.png",collision:!0},{path:"/map/Cafe.png",collision:!0},{path:null,collision:!1},{path:"/map/Internet.png",collision:!0},{path:"/map/roadEW.png",collision:!1},{path:"/map/roadSW.png",collision:!1},{path:"/map/roadNE.png",collision:!1},{path:"/map/roadSE.png",collision:!1},{path:"/map/roadNW.png",collision:!1}].map((i,t)=>i.path?new Promise(a=>{this.tiles[t]=new x,this.tiles[t].collision=i.collision,this.tiles[t].image=new Image,this.tiles[t].image.onload=()=>a(),this.tiles[t].image.src=i.path}):Promise.resolve());await Promise.all(s)}async loadMap(e){const s=e.trim().split(`
`);for(let i=0;i<this.maxScreenRow;i++){const t=s[i].trim().split(" ");for(let a=0;a<this.maxScreenCol;a++)this.tileMap[a][i]=parseInt(t[a])}}draw(e){for(let s=0;s<this.maxScreenRow;s++)for(let i=0;i<this.maxScreenCol;i++){const t=i*this.tileSize,a=s*this.tileSize,l=this.tileMap[i][s];this.tiles[l]&&this.tiles[l].image&&e.drawImage(this.tiles[l].image,t,a,this.tileSize,this.tileSize)}}getTileCollision(e,s){if(e<0||e>=this.maxScreenCol||s<0||s>=this.maxScreenRow)return!0;const i=this.tileMap[e][s];return this.tiles[i]?.collision??!1}}class k{constructor(){this.name="",this.image=null,this.collision=!1,this.x=0,this.y=0,this.scale=1}draw(e,s){if(this.image){const i=s.tileSize*.7,t=(s.tileSize-i)/2,a=(s.tileSize-i)/2;e.drawImage(this.image,this.x+t,this.y+a,i,i)}}}class L extends k{constructor(e){super(),this.name="person",this.loadImage(e)}async loadImage(e){return new Promise(s=>{this.image=new Image,this.image.onload=()=>s(),this.image.src=`/person/${e}`})}}class O extends k{constructor(e){super(),this.name="obstacles",this.collision=!0,this.loadImage(e)}async loadImage(e){return new Promise(s=>{this.image=new Image,this.image.onload=()=>s(),this.image.src=`/objects/${e}`})}}class T{constructor(e){this.tileSize=e,this.objects=new Array(15).fill(null)}async setObjects(){const e=[{file:"PersonaCorbata.png",x:4,y:6},{file:"PersonaNaranja.png",x:8,y:5},{file:"mujer.png",x:10,y:3},{file:"mujer1.png",x:12,y:7},{file:"personaCampesino.png",x:5,y:5},{file:"personaEstudiante.png",x:2,y:4},{file:"personaVerde.png",x:6,y:9},{file:"tombo.png",x:3,y:4},{file:"tombo1.png",x:14,y:9}],s=[{file:"huecos.png",x:6,y:6},{file:"motoEnElPiso.png",x:3,y:3},{file:"senal.png",x:9,y:11},{file:"senal1.png",x:9,y:10},{file:"senal2.png",x:8,y:9},{file:"senal3.png",x:9,y:9}],i=[];return e.forEach((t,a)=>{this.objects[a]=new L(t.file),this.objects[a].x=t.x*this.tileSize,this.objects[a].y=t.y*this.tileSize,i.push(this.objects[a].loadImage(t.file))}),s.forEach((t,a)=>{const l=a+e.length;this.objects[l]=new O(t.file),this.objects[l].x=t.x*this.tileSize,this.objects[l].y=t.y*this.tileSize,i.push(this.objects[l].loadImage(t.file))}),await Promise.all(i),this.objects}}class K{constructor(e,s){this.tileSize=e,this.tileManager=s}checkTile(e){const s=e.x+e.solidArea.x,i=e.x+e.solidArea.x+e.solidArea.width,t=e.y+e.solidArea.y,a=e.y+e.solidArea.y+e.solidArea.height,l=Math.floor(s/this.tileSize),o=Math.floor(i/this.tileSize),n=Math.floor(t/this.tileSize),u=Math.floor(a/this.tileSize);let r,c;switch(e.direction){case"up":const m=Math.floor((t-e.speed)/this.tileSize);r=this.tileManager.tileMap[l][m],c=this.tileManager.tileMap[o][m],(this.tileManager.tiles[r]?.collision||this.tileManager.tiles[c]?.collision)&&(e.collisionOn=!0);break;case"down":const f=Math.floor((a+e.speed)/this.tileSize);r=this.tileManager.tileMap[l][f],c=this.tileManager.tileMap[o][f],(this.tileManager.tiles[r]?.collision||this.tileManager.tiles[c]?.collision)&&(e.collisionOn=!0);break;case"left":const w=Math.floor((s-e.speed)/this.tileSize);r=this.tileManager.tileMap[w][n],c=this.tileManager.tileMap[w][u],(this.tileManager.tiles[r]?.collision||this.tileManager.tiles[c]?.collision)&&(e.collisionOn=!0);break;case"right":const g=Math.floor((i+e.speed)/this.tileSize);r=this.tileManager.tileMap[g][n],c=this.tileManager.tileMap[g][u],(this.tileManager.tiles[r]?.collision||this.tileManager.tiles[c]?.collision)&&(e.collisionOn=!0);break}}checkObject(e,s,i=!1){let t=999;return s.forEach((a,l)=>{if(!a)return;const o={x:e.x+e.solidArea.x,y:e.y+e.solidArea.y,width:e.solidArea.width,height:e.solidArea.height},n={x:a.x+(a.solidArea?.x||0),y:a.y+(a.solidArea?.y||0),width:a.solidArea?.width||this.tileSize,height:a.solidArea?.height||this.tileSize};switch(e.direction){case"up":o.y-=e.speed;break;case"down":o.y+=e.speed;break;case"left":o.x-=e.speed;break;case"right":o.x+=e.speed;break}this.checkIntersect(o,n)&&(a.collision&&(e.collisionOn=!0),i&&(t=l))}),t}checkIntersect(e,s){return e.x<s.x+s.width&&e.x+e.width>s.x&&e.y<s.y+s.height&&e.y+e.height>s.y}}class D{constructor(){this.upPressed=!1,this.downPressed=!1,this.leftPressed=!1,this.rightPressed=!1,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this)}init(){typeof window<"u"&&(window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp))}handleKeyDown(e){switch(e.key.toLowerCase()){case"w":this.upPressed=!0;break;case"s":this.downPressed=!0;break;case"a":this.leftPressed=!0;break;case"d":this.rightPressed=!0;break}}handleKeyUp(e){switch(e.key.toLowerCase()){case"w":this.upPressed=!1;break;case"s":this.downPressed=!1;break;case"a":this.leftPressed=!1;break;case"d":this.rightPressed=!1;break}}cleanup(){typeof window<"u"&&(window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp))}}const W={class:"game-container"},B={class:"game-hud"},H={class:"score"},U=26,F=3,v=16,M=12,G={__name:"GameCanvas",setup(p){const e=U*F,s=e*v,i=e*M,t=d(new D),a=d(null),l=d(null),o=d(null),n=d(new C(s,i,e)),u=d(new Array(15).fill(null)),r=d(null),c=d(new I),m=async()=>{o.value=new j(v,M,e),r.value=new K(e,o.value);const h=new T(e);await Promise.all([o.value.loadTiles(),n.value.loadImages(),h.setObjects().then(E=>{u.value=E})]),await o.value.loadMap(`
    15 16 1 6 3 1 6 2 1 6 1 8 6 2 18 15
    1 6 2 6 1 14 6 1 4 6 1 1 6 1 6 2
    1 17 15 5 15 15 5 15 15 5 15 15 5 15 19 1
    2 9 0 6 1 7 6 1 3 6 1 8 6 4 1 0
    1 1 1 6 10 1 6 1 2 6 1 1 6 1 11 2
    15 15 15 5 15 15 5 15 15 5 15 15 5 15 15 15
    1 2 1 6 4 2 6 1 12 6 1 3 6 2 10 1
    3 1 11 6 1 14 6 1 1 6 7 1 6 1 2 1
    1 1 2 6 2 1 6 0 1 6 1 1 6 1 1 1
    1 18 15 5 15 15 5 15 15 5 15 15 5 15 16 9
    9 6 2 6 1 1 6 10 1 6 14 2 6 14 6 1
    15 19 1 6 12 2 6 1 1 6 1 1 6 1 17 15

`)},f=()=>{const h=a.value.getContext("2d");h.clearRect(0,0,s,i),h.fillStyle="black",h.fillRect(0,0,s,i),o.value&&o.value.draw(h),u.value.forEach(y=>{y&&y.draw(h,{tileSize:e})}),n.value.draw(h)},w=()=>{if(n.value&&r.value){const h={up:t.value.upPressed,down:t.value.downPressed,left:t.value.leftPressed,right:t.value.rightPressed};n.value.update(h,r.value,u.value),c.value.sendPlayerPosition({x:n.value.x,y:n.value.y,direction:n.value.direction,hasPerson:n.value.hasPerson})}},g=()=>{w(),f(),l.value=requestAnimationFrame(g)};return A(async()=>{await m(),t.value.init(),c.value.connect(),g()}),z(()=>{t.value.cleanup(),c.value.disconnect(),l.value&&cancelAnimationFrame(l.value)}),(h,y)=>(P(),b("div",W,[S("canvas",{ref_key:"gameCanvas",ref:a,width:s,height:i},null,512),S("div",B,[S("span",H,"Personas: "+R(n.value.hasPerson),1)])]))}},$=_(G,[["__scopeId","data-v-afd2f0b6"]]),V={class:"game-page"},X={__name:"page",setup(p){return(e,s)=>(P(),b("div",V,[N($)]))}},Y=_(X,[["__scopeId","data-v-2610d004"]]);export{Y as default};
